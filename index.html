<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Babaq avlodlari shajarasi</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: #f4f8fb;
      text-align: center;
      overflow: hidden;
    }

    header {
      background: linear-gradient(90deg, #003c96, #0055d4);
      color: white;
      font-size: 24px;
      font-weight: bold;
      padding: 20px;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .controls {
      margin: 15px 0;
    }

    button {
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 10px 15px;
      margin: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
    }

    button:hover {
      background-color: #0056b3;
      transform: scale(1.05);
    }

    .tree-container {
      position: relative;
      width: 100%;
      height: calc(100vh - 150px);
      overflow: auto;
    }

    .node {
      position: absolute;
      display: inline-block;
      background: white;
      border: 2px solid #007bff;
      border-radius: 50px;
      padding: 10px 18px;
      color: #333;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      transition: 0.3s;
      white-space: nowrap;
    }

    .node:hover {
      background: #e8f0ff;
      transform: scale(1.05);
    }

    .selected {
      background: #007bff !important;
      color: white !important;
      box-shadow: 0 0 15px rgba(0,123,255,0.7);
    }

    svg {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
      overflow: visible;
    }
  </style>
</head>
<body>

  <header>üå≥ Babaq avlodlari shajarasi</header>

  <div class="controls">
    <button onclick="addChild()">‚ûï O‚Äòg‚Äòil qo‚Äòshish</button>
    <button onclick="deleteSelected()">‚ùå Belgilangan shaxsni o‚Äòchirish</button>
    <button onclick="saveTree()">üíæ Saqlash</button>
    <button onclick="resetTree()">‚ôªÔ∏è Qayta tiklash</button>
  </div>

  <div class="tree-container" id="treeContainer">
    <svg id="lines"></svg>
  </div>

  <script>
    const defaultTree = {
      name: "Babaq",
      children: [
        {
          name: "Dauletnazar",
          children: [
            { name: "rustem", children: [{ name: "dwd", children: [] }] },
            { name: "azamat", children: [] }
          ]
        },
        {
          name: "Xakim Bolis",
          children: [
            { name: "palenshe", children: [] },
            { name: "tolenshe", children: [] }
          ]
        }
      ]
    };

    let treeData = JSON.parse(localStorage.getItem("babaqTree")) || structuredClone(defaultTree);
    let selectedNodeName = null;

    function renderTree() {
      const container = document.getElementById("treeContainer");
      const svg = document.getElementById("lines");
      container.querySelectorAll(".node").forEach(n => n.remove());
      svg.innerHTML = "";

      const levelGapY = 120;
      const siblingGapX = 140;
      const nodePositions = {};

      function layout(node, depth, xOffset) {
        let width = 0;
        if (node.children.length === 0) {
          width = 1;
        } else {
          width = node.children.map(c => layout(c, depth + 1, xOffset + width)).reduce((a, b) => a + b, 0);
        }
        const mid = xOffset + width / 2;
        nodePositions[node.name] = { x: mid * siblingGapX + 100, y: depth * levelGapY + 50, node };
        return width;
      }

      layout(treeData, 0, 0);

      for (const key in nodePositions) {
        const n = nodePositions[key];
        const div = document.createElement("div");
        div.className = "node" + (selectedNodeName === n.node.name ? " selected" : "");
        div.innerText = n.node.name;
        div.style.left = `${n.x}px`;
        div.style.top = `${n.y}px`;
        div.onclick = () => selectNode(n.node.name);
        container.appendChild(div);

        n.node.children.forEach(child => {
          const c = nodePositions[child.name];
          const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
          const startX = n.x + 60;
          const startY = n.y + 40;
          const endX = c.x + 60;
          const endY = c.y;
          const curve = `M ${startX},${startY} C ${startX},${(startY + endY) / 2} ${endX},${(startY + endY) / 2} ${endX},${endY}`;
          path.setAttribute("d", curve);
          path.setAttribute("stroke", "#007bff");
          path.setAttribute("fill", "none");
          path.setAttribute("stroke-width", "2");
          svg.appendChild(path);
        });
      }
    }

    function selectNode(name) {
      selectedNodeName = selectedNodeName === name ? null : name;
      renderTree();
    }

    function findNode(node, name) {
      if (node.name === name) return node;
      for (const c of node.children) {
        const found = findNode(c, name);
        if (found) return found;
      }
      return null;
    }

    function addChild() {
      if (!selectedNodeName) return alert("Avval kimga o‚Äòg‚Äòil qo‚Äòshmoqchi ekanligingizni belgilang!");
      const newName = prompt("Yangi o‚Äòg‚Äòil ismini kiriting:");
      if (!newName) return;
      const parent = findNode(treeData, selectedNodeName);
      parent.children.push({ name: newName, children: [] });
      renderTree();
    }

    function deleteSelected() {
      if (!selectedNodeName) return alert("Avval o‚Äòchirmoqchi bo‚Äòlgan shaxsni belgilang!");
      if (selectedNodeName === "Babaq") return alert("Babaqni o‚Äòchirish mumkin emas!");
      if (confirm(`${selectedNodeName}ni o‚Äòchirmoqchimisiz?`)) {
        removeNode(treeData, selectedNodeName);
        selectedNodeName = null;
        renderTree();
      }
    }

    function removeNode(node, name) {
      node.children = node.children.filter(c => c.name !== name);
      node.children.forEach(c => removeNode(c, name));
    }

    function saveTree() {
      localStorage.setItem("babaqTree", JSON.stringify(treeData));
      alert("‚úÖ Daraxt saqlandi!");
    }

    function resetTree() {
      if (confirm("Barcha o‚Äòzgarishlar o‚Äòchadi. Qayta tiklaysizmi?")) {
        treeData = structuredClone(defaultTree);
        localStorage.setItem("babaqTree", JSON.stringify(treeData));
        selectedNodeName = null;
        renderTree();
      }
    }

    renderTree();
  </script>
</body>
</html>
